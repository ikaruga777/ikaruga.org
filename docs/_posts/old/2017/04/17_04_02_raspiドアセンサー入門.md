---
title: 17/04/02 raspiドアセンサー入門
date: 2017-04-02 01:05:00 +0900
feed:
  enable: true
layout: post
---
<h2>発端</h2>    <blockquote class="twitter-tweet" data-lang="ja">      <p lang="ja" dir="ltr">        家の扉開けたら、エンプレスマーチが流れるようにならないかな      </p>      — 偽人妻 (@moknek)      <a href="https://twitter.com/moknek/status/827399704174436353" target="_blank">2017年2月3日</a>    </blockquote>    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>    <p>引っ越し&amp;誕生日が近いとのことだったので、実践することにした。</p>    <h2>エンプレスマーチとは</h2>    <p>      TITLE MUSIC / EMPRESS MARCH / DJ YOSHITAKA つまるところbeatmania IIDX 16      のオープニング。    </p>    <h2>物品の準備</h2>    <h3>raspberry pi</h3>    <p>      制御に使う。<br>      3,4年前に買った古いラズパイを掘り起こして、RASPBIAN JESSIE      LITE入れ直したらさっくり起動した。<br>      起動しなくなったから新しいラズパイを買ったはずだったのに、起動するラズパイが増えてしまった。    </p>    <h3>ドアセンサー</h3>    <p>      家の扉の開閉を検知するのに使う。<br>      いわゆるマグネットセンサーってやつ。    </p>    <h3>スピーカー</h3>    <p>      エンプレスマーチを流すのに使う。<br>      ヨドバシで電源使わないタイプのスピーカー買った。けど、usbから電源居給するやつを使ってもいいかもしれない。    </p>    <h3>電子素子、ケーブル、ブレッドボード</h3>    <p>      電子配線に使う。<br>      一切持ってなかったので秋葉に買いに行った。    </p>    <p>あとはよしなに。</p>    <h2>やったこと</h2>    <p>メモも含めて。</p>    <h3>ネットワーク</h3>    <p>      <a href="http://qiita.com/hotchpotch/items/dfcb9bd02baf67223eb0" target="_blank">http://qiita.com/hotchpotch/items/dfcb9bd02baf67223eb0</a>      大体ここで片付く。<br>      固定にする必要もなさそうなのでdhcpで楽する。    </p>    <h3>raspiの音</h3>    <p>      <code>amixer cset numid=3 n</code>で出力の切り替え(HDMI,ヘッドホン端子)<br><code>amixer cset numid=1 n%</code>で音量調節<br>      mp3再生するのにはmpg321を使った。<br><code>apt-get install mpg321</code>    </p>    <h3>配線</h3>    <p>      9年前の記憶を掘り起こしながら組んだ。<br>      ロボ研でもうちょっと回路触っておけばチョロだったのかもしれない。<br>      最初GPIO2で読み取ろうとしてたんだけど、最初から抵抗が入ってるためにLOWにならない問題にハマって1日潰れた。<br>      隣の隣のGPIO4を使うようにして解決。      <a href="https://tool-lab.com/make/raspberrypi-startup-22/" target="_blank">https://tool-lab.com/make/raspberrypi-startup-22/</a>      10回くらい読んだ。    </p>    <h3>node</h3>    <p>      プログラムは適当にnodejsで書いた。<br>      <a href="http://qiita.com/setouchi/items/437e4b62e4210871496f" target="_blank">http://qiita.com/setouchi/items/437e4b62e4210871496f</a>    </p>    <p>      死ぬほど雑に書いたから晒せず。simplayerってライブラリ使ったんだけど、中の<code>aplay</code>を<code>mpg321</code>に書き換えてる。<br>      検知とイベントをとりあえず別に分けて他の用途にも使えるようにしたい。    </p>    <h2>実践</h2>    <p>新居でエンプレスマーチを流すことに成功した。</p>    <div id="footer">      <span id="timestamp"> April 2nd, 2017 1:05am </span>    </div>
